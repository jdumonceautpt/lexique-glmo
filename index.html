<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexique Interactif - SharePoint</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #3a3a3a 0%, #2d2d2d 100%);
            padding: 20px 25px;
            border-bottom: 2px solid #00d4ff;
        }

        h1 {
            font-size: 1.5em;
            margin-bottom: 12px;
            color: #ffa500;
            font-weight: 600;
        }

        .search-container {
            position: relative;
        }

        #searchInput {
            width: 100%;
            padding: 10px 15px;
            font-size: 0.9em;
            border: 1px solid #444;
            border-radius: 5px;
            background: #3a3a3a;
            color: #e0e0e0;
            outline: none;
            transition: all 0.2s;
        }

        #searchInput:focus {
            border-color: #00d4ff;
            background: #424242;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.1);
        }

        #searchInput::placeholder {
            color: #888;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #00d4ff;
            font-size: 1em;
        }

        .content {
            padding: 20px 25px;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 12px;
            background: #3a3a3a;
            border-radius: 5px;
            border-left: 3px solid #00d4ff;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.4em;
            font-weight: bold;
            color: #ffa500;
        }

        .stat-label {
            color: #999;
            font-size: 0.75em;
            margin-top: 2px;
        }

        #lexiqueList {
            display: grid;
            gap: 8px;
        }

        .lexique-item {
            display: grid;
            grid-template-columns: 280px 1fr 180px;
            gap: 20px;
            padding: 12px 15px;
            background: #3a3a3a;
            border-radius: 5px;
            border-left: 3px solid #00d4ff;
            transition: all 0.2s;
            align-items: start;
        }

        .lexique-item:hover {
            background: #424242;
            border-left-color: #00f0ff;
            transform: translateX(3px);
        }

        .terme {
            font-size: 0.95em;
            font-weight: 600;
            color: #00d4ff;
            line-height: 1.3;
        }

        .definition {
            color: #b0b0b0;
            line-height: 1.4;
            font-size: 0.85em;
        }

        .estimated-effort {
            color: #00d4ff;
            line-height: 1.4;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .estimated-effort-label {
            color: #888;
            position: relative;
            cursor: help;
        }

        .estimated-effort-label::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a1a;
            color: #00d4ff;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            margin-bottom: 5px;
            border: 1px solid #00d4ff;
            z-index: 1000;
        }

        .estimated-effort-label:hover::after {
            opacity: 1;
        }

        /* Tooltip rose pour les t√¢ches personnalis√©es */
        .lexique-item.custom .estimated-effort-label::after {
            color: #ff6b9d;
            border-color: #ff6b9d;
        }

        .estimated-effort-value {
            background: #2d2d2d;
            padding: 3px 8px;
            border-radius: 3px;
            border: 1px solid #444;
            color: #00d4ff;
            cursor: text;
            transition: all 0.2s;
            display: inline-block;
            min-width: 60px;
            flex: 0 1 auto;
        }

        .estimated-effort-value:hover {
            background: #3a3a3a;
            border-color: #00d4ff;
        }

        .estimated-effort-value:focus {
            outline: none;
            background: #424242;
            border-color: #00f0ff;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.1);
        }

        /* Styles pour les familles de t√¢ches */
        .family-section {
            margin-bottom: 25px;
        }

        .family-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #3a3a3a;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 3px solid #00d4ff;
        }

        .family-title {
            color: #e0e0e0;
            font-size: 1em;
            font-weight: 600;
        }

        .order-btn {
            background: transparent;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 0 8px 0 0;
            color: #00d4ff;
        }

        .order-btn:hover {
            transform: scale(1.2);
        }

        .family-count {
            color: #888;
            font-size: 0.85em;
            margin-left: 10px;
        }

        .add-task-btn {
            background: #ff6b9d;
            border: none;
            padding: 6px 15px;
            border-radius: 4px;
            color: #1a1a1a;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-task-btn:hover {
            background: #ff85ad;
            transform: translateY(-1px);
        }

        /* T√¢ches personnalis√©es en rose */
        .lexique-item.custom {
            border-left-color: #ff6b9d;
        }

        .lexique-item.custom .terme {
            color: #ff6b9d;
        }

        .lexique-item.custom .estimated-effort-value {
            color: #ff6b9d;
            border-color: #ff6b9d;
        }

        .lexique-item.custom .estimated-effort-value:hover {
            border-color: #ff85ad;
        }

        .lexique-item.custom .estimated-effort-value:focus {
            border-color: #ff6b9d;
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.1);
        }

        /* Boutons d'action pour les t√¢ches personnalis√©es */
        .task-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-left: auto;
        }

        .action-btn {
            background: #444;
            border: 1px solid #555;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s;
            color: #e0e0e0;
        }

        .action-btn.edit:hover {
            background: #ff6b9d;
            border-color: #ff6b9d;
            color: #1a1a1a;
        }

        .action-btn.delete:hover {
            background: #ff4444;
            border-color: #ff4444;
            color: white;
        }

        /* Modal d'ajout/√©dition de t√¢che */
        .task-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .task-modal-overlay.hidden {
            display: none;
        }

        .task-modal {
            background: #2d2d2d;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #ff6b9d;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .task-modal h3 {
            color: #ff6b9d;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            color: #888;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            background: #3a3a3a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 0.9em;
            outline: none;
            transition: all 0.2s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .form-textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            border-color: #ff6b9d;
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn.save {
            background: #ff6b9d;
            color: #1a1a1a;
        }

        .modal-btn.save:hover {
            background: #ff85ad;
        }

        .modal-btn.cancel {
            background: #444;
            color: #e0e0e0;
        }

        .modal-btn.cancel:hover {
            background: #555;
        }

        /* Modal de confirmation de suppression */
        .confirm-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .confirm-modal-overlay.hidden {
            display: none;
        }

        .confirm-modal {
            background: #2d2d2d;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #ff4444;
            max-width: 400px;
            width: 90%;
        }

        .confirm-modal h3 {
            color: #ff4444;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .confirm-modal p {
            color: #e0e0e0;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 10px;
        }

        .confirm-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .confirm-btn.delete-confirm {
            background: #ff4444;
            color: white;
        }

        .confirm-btn.delete-confirm:hover {
            background: #ff6666;
        }

        .confirm-btn.delete-cancel {
            background: #444;
            color: #e0e0e0;
        }

        .confirm-btn.delete-cancel:hover {
            background: #555;
        }

        /* Bouton retour en haut */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #ffa500;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: #1a1a1a;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.3);
            transition: all 0.3s;
            z-index: 999;
            display: none;
        }

        .back-to-top.visible {
            display: block;
        }

        .back-to-top:hover {
            background: #ffb733;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 165, 0, 0.4);
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .no-results-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .highlight {
            background: #00d4ff;
            color: #1a1a1a;
            font-weight: bold;
            padding: 1px 3px;
            border-radius: 2px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.3em;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }

            .lexique-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .terme {
                border-bottom: 2px solid #00d4ff;
                padding-bottom: 6px;
            }

            .estimated-effort {
                text-align: left;
                padding-top: 6px;
                border-top: 1px solid #444;
            }
        }

        /* Scrollbar styling pour le th√®me sombre */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #2d2d2d;
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00d4ff;
        }

        /* Modal de connexion */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .auth-overlay.hidden {
            display: none;
        }

        .auth-modal {
            background: #2d2d2d;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.2);
            border: 1px solid #444;
            max-width: 320px;
            width: 90%;
        }

        .auth-modal h2 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.3em;
            text-align: center;
            font-weight: 600;
        }

        .auth-input {
            width: 100%;
            padding: 10px 12px;
            background: #3a3a3a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 0.95em;
            margin-bottom: 12px;
            outline: none;
            transition: all 0.2s;
        }

        .auth-input:focus {
            border-color: #00d4ff;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.1);
        }

        .auth-button {
            width: 100%;
            padding: 10px;
            background: #00d4ff;
            border: none;
            border-radius: 4px;
            color: #1a1a1a;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .auth-button:hover {
            background: #00f0ff;
        }

        .auth-error {
            color: #ff4444;
            font-size: 0.8em;
            margin-top: 8px;
            text-align: center;
            display: none;
        }

        .auth-error.visible {
            display: block;
        }

        .access-mode {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3a3a3a;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #00d4ff;
            font-size: 0.85em;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .access-mode-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .access-mode-label {
            color: #888;
        }

        .access-mode-value {
            color: #00d4ff;
            font-weight: 600;
        }

        .access-mode-value.readonly {
            color: #ffa500;
        }

        .access-mode-value.partial {
            color: #ffcc00;
        }

        .access-mode-value.full-write {
            color: #00d4ff;
        }

        .switch-mode-btn {
            background: #444;
            border: 1px solid #555;
            color: #ffa500;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .switch-mode-btn:hover {
            background: #555;
            border-color: #ffa500;
        }

        /* Bouton d'export */
        .export-container {
            position: relative;
        }

        .export-btn {
            background: #444;
            border: 1px solid #555;
            color: #ffa500;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: #555;
            border-color: #ffa500;
        }

        .export-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 5px;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1001;
            min-width: 120px;
        }

        .export-menu.visible {
            display: block;
        }

        .export-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s;
            color: #e0e0e0;
            font-size: 0.85em;
        }

        .export-option:hover {
            background: #3a3a3a;
            color: #00d4ff;
        }

        .export-option:first-child {
            border-radius: 4px 4px 0 0;
        }

        .export-option:last-child {
            border-radius: 0 0 4px 4px;
        }
    </style>
</head>
<body>
    <!-- Modal de connexion -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <h2>üîí Connexion</h2>
            <input 
                type="password" 
                id="passwordInput" 
                class="auth-input" 
                placeholder="Mot de passe"
                autofocus
            >
            <button class="auth-button" onclick="authenticate()">Valider</button>
            <div class="auth-error" id="authError">Mot de passe incorrect</div>
        </div>
    </div>

    <!-- Indicateur du mode d'acc√®s -->
    <div class="access-mode" id="accessMode" style="display: none;">
        <div class="access-mode-info">
            <span class="access-mode-label">Mode :</span>
            <span class="access-mode-value" id="accessModeValue">Lecture seule</span>
        </div>
        <button class="switch-mode-btn" onclick="switchMode()">Changer</button>
        <button class="switch-mode-btn" onclick="toggleLanguage()" id="langValue">üá´üá∑ FR</button>
        <div class="export-container">
            <button class="export-btn" onclick="toggleExportMenu()">üì• Exporter</button>
            <div class="export-menu" id="exportMenu">
                <div class="export-option" onclick="exportToExcel()">üìä Excel (.xlsx)</div>
                <div class="export-option" onclick="exportToCSV()">üìÑ CSV (.csv)</div>
            </div>
        </div>
    </div>

    <!-- Modal d'ajout/√©dition de t√¢che -->
    <div class="task-modal-overlay hidden" id="taskModalOverlay">
        <div class="task-modal">
            <h3 id="taskModalTitle">‚ûï Ajouter une t√¢che</h3>
            <div id="taskForm">
                <div class="form-group">
                    <label class="form-label">Nom de la t√¢che *</label>
                    <input type="text" class="form-input" id="taskName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description (EN) *</label>
                    <textarea class="form-textarea" id="taskDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Description (FR) *</label>
                    <textarea class="form-textarea" id="taskDescriptionFR" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Cat√©gorie de co√ªt *</label>
                    <select class="form-select" id="taskCostCategory" required>
                        <option value="">-- S√©lectionner --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Effort estim√© * (ex: 2*RT ou 45)</label>
                    <input type="text" class="form-input" id="taskEstimatedEffort" placeholder="ex: 2*RT ou 45" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="modal-btn cancel" onclick="closeTaskModal()">Annuler</button>
                    <button type="button" class="modal-btn save" onclick="saveTask()">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmation de suppression -->
    <div class="confirm-modal-overlay hidden" id="confirmModalOverlay">
        <div class="confirm-modal">
            <h3>‚ö†Ô∏è Confirmer la suppression</h3>
            <p id="confirmMessage">√ätes-vous s√ªr de vouloir supprimer cette t√¢che ?</p>
            <div class="confirm-buttons">
                <button class="confirm-btn delete-cancel" onclick="cancelDelete()">Annuler</button>
                <button class="confirm-btn delete-confirm" onclick="confirmDelete()">Supprimer</button>
            </div>
        </div>
    </div>

    <!-- Bouton retour en haut -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()" title="Retour en haut">‚Üë</button>

    <div class="container">
        <div class="header">
            <h1>üìã Lexique des t√¢ches Media Orders</h1>
            <div class="search-container">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Rechercher un terme..."
                    autocomplete="off"
                >
                <span class="search-icon">üîç</span>
            </div>
        </div>

        <div class="content">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalTerms">0</div>
                    <div class="stat-label">Termes au total</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="displayedTerms">0</div>
                    <div class="stat-label">Termes affich√©s</div>
                </div>
            </div>

            <div id="lexiqueList"></div>
        </div>
    </div>

    <!-- Biblioth√®que pour l'export Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, setDoc, doc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
        
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC3wKIkd67ttGYkr3xLX9BIxB_j0sJB9xg",
            authDomain: "lexique-glmo.firebaseapp.com",
            projectId: "lexique-glmo",
            storageBucket: "lexique-glmo.firebasestorage.app",
            messagingSenderId: "531184499253",
            appId: "1:531184499253:web:3c7b311e2116be245e0f7c",
            measurementId: "G-GDSKYGBE3Y"
        };
        
        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Rendre Firestore accessible globalement
        window.firestoreDB = db;
        window.firestoreCollection = collection;
        window.firestoreGetDocs = getDocs;
        window.firestoreSetDoc = setDoc;
        window.firestoreDoc = doc;
        window.firestoreDeleteDoc = deleteDoc;
        window.firestoreOnSnapshot = onSnapshot;
    </script>

    <script>
        // ========================================
        // SYST√àME D'AUTHENTIFICATION
        // ========================================
        
        let accessMode = null; // 'readonly' ou 'write'
        
        // Mots de passe (√Ä MODIFIER en production !)
        const PASSWORD_READONLY = '123';
        const PASSWORD_PARTIAL_WRITE = '456';  // Nouveau : √©dition temps estim√©s uniquement
        const PASSWORD_FULL_WRITE = '789';     // Nouveau : √©dition compl√®te
        
        function authenticate() {
            const password = document.getElementById('passwordInput').value;
            const authError = document.getElementById('authError');
            const authOverlay = document.getElementById('authOverlay');
            const accessModeDiv = document.getElementById('accessMode');
            const accessModeValue = document.getElementById('accessModeValue');
            
            const previousMode = accessMode;
            const currentSearch = document.getElementById('searchInput').value;
            
            if (password === PASSWORD_FULL_WRITE) {
                // Acc√®s en √©criture compl√®te (789)
                accessMode = 'full_write';
                accessModeValue.textContent = '√âcriture compl√®te';
                accessModeValue.classList.remove('readonly', 'partial');
                accessModeValue.classList.add('full-write');
                authOverlay.classList.add('hidden');
                accessModeDiv.style.display = 'flex';
                
                if (previousMode !== null && previousMode !== 'full_write') {
                    if (currentSearch) {
                        searchLexique(currentSearch);
                    } else {
                        displayLexique();
                    }
                } else {
                    initializeLexique();
                }
            } else if (password === PASSWORD_PARTIAL_WRITE) {
                // Acc√®s en √©criture partielle (456) - uniquement temps estim√©s
                accessMode = 'partial_write';
                accessModeValue.textContent = '√âcriture partielle';
                accessModeValue.classList.remove('readonly', 'full-write');
                accessModeValue.classList.add('partial');
                authOverlay.classList.add('hidden');
                accessModeDiv.style.display = 'flex';
                
                if (previousMode !== null && previousMode !== 'partial_write') {
                    if (currentSearch) {
                        searchLexique(currentSearch);
                    } else {
                        displayLexique();
                    }
                } else {
                    initializeLexique();
                }
            } else if (password === PASSWORD_READONLY) {
                // Acc√®s en lecture seule (123)
                accessMode = 'readonly';
                accessModeValue.textContent = 'Lecture seule';
                accessModeValue.classList.remove('partial', 'full-write');
                accessModeValue.classList.add('readonly');
                authOverlay.classList.add('hidden');
                accessModeDiv.style.display = 'flex';
                
                if (previousMode !== null && previousMode !== 'readonly') {
                    if (currentSearch) {
                        searchLexique(currentSearch);
                    } else {
                        displayLexique();
                    }
                } else {
                    initializeLexique();
                }
            } else {
                // Mot de passe incorrect
                authError.classList.add('visible');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                
                // Masquer l'erreur apr√®s 3 secondes
                setTimeout(() => {
                    authError.classList.remove('visible');
                }, 3000);
            }
        }
        
        // Fonction pour changer de mode d'acc√®s
        function switchMode() {
            const authOverlay = document.getElementById('authOverlay');
            const passwordInput = document.getElementById('passwordInput');
            const authError = document.getElementById('authError');
            
            // R√©initialiser la modal
            passwordInput.value = '';
            authError.classList.remove('visible');
            
            // Afficher la modal
            authOverlay.classList.remove('hidden');
            passwordInput.focus();
        }
        
        // Permettre la connexion avec la touche Enter
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    authenticate();
                }
            });
        });
        
        async function initializeLexique() {
            // Charger les t√¢ches personnalis√©es depuis Firebase (async)
            await loadCustomTasks();
            
            // Charger l'ordre des familles depuis localStorage
            loadFamilyOrder();
            
            // Charger la pr√©f√©rence de langue depuis localStorage
            loadLanguagePreference();
            
            // Mettre √† jour le bouton langue
            const langBtn = document.getElementById('langValue');
            if (langBtn) {
                langBtn.textContent = showFrenchDescription ? 'üá´üá∑ FR' : 'üá¨üáß EN';
            }
            
            displayLexique();
            updateStats(nativeTasksData.length + customTasksData.length, nativeTasksData.length + customTasksData.length);
            
            // Initialiser la recherche en temps r√©el (une seule fois)
            if (!window.searchInitialized) {
                document.getElementById('searchInput').addEventListener('input', function(e) {
                    searchLexique(e.target.value);
                });
                window.searchInitialized = true;
            }
        }

        // ========================================
        // DONN√âES DU LEXIQUE - MODIFIEZ ICI
        // ========================================
        // Pour mettre √† jour le lexique :
        // 1. Utilisez le convertisseur Excel vers JSON
        // 2. Copiez le code g√©n√©r√©
        // 3. Remplacez la variable nativeTasksData ci-dessous
        
        // Famille 1 : T√¢ches natives GLMO (lecture seule sauf estimated_effort)
        let nativeTasksData = [
              {
				"Name": "AU Deliverable creation",
				"Description": "Create audio deliverable according to specs",
				"Description_FR": "Cr√©ation de livrable audio selon les sp√©cifications clients",
				"cost_category": "AUDIO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AU Edit",
				"Description": "Edit audio",
				"Description_FR": "Montage Audio",
				"cost_category": "AUDIO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AU Edit + Mix 2.0",
				"Description": "Audio Edit and Mix 2.0",
				"Description_FR": "Montage et Mixage Audio 2.0",
				"cost_category": "AUDIO-I",
				"estimated_effort": "60"
			  },
			  {
				"Name": "AU Edit + Mix 5.1",
				"Description": "Audio Edit and Mix 5.1",
				"Description_FR": "Montage et Mixage Audio 5.1",
				"cost_category": "AUDIO-I",
				"estimated_effort": "30"
			  },
			  {
				"Name": "AU ICR",
				"Description": "Audio In Client Review ‚Äì Client listening to dubbed audio track or a low res video screener (previous tasks can determine what the team creates)",
				"Description_FR": "Review Audio Client - V√©rification Client des assets, audio ou screener. (les t√¢ches pr√©c√©dentes peuvent d√©terminer ce que l'√©quipe cr√©e)",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "AU M&E Check",
				"Description": "Checking the effects track provided by the client against the video",
				"Description_FR": "V√©rification des pistes Musique et Effets fournie par le client par rapport √† la vid√©o",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AU M&E Creation",
				"Description": "Create the new effects / sound design",
				"Description_FR": "Cr√©ation des musiques, effets, et fonds/habillage sonores",
				"cost_category": "AUDIO-I",
				"estimated_effort": "25"
			  },
			  {
				"Name": "AU Mix 2.0",
				"Description": "Mix audio",
				"Description_FR": "Mixage Audio (2.0)",
				"cost_category": "AUDIO-I",
				"estimated_effort": "30"
			  },
			  {
				"Name": "AU Mix 5.1",
				"Description": "Mix audio",
				"Description_FR": "Mixage Audio (5.1)",
				"cost_category": "AUDIO-I",
				"estimated_effort": "60"
			  },
			  {
				"Name": "AU PG creation & approval",
				"Description": "Create Pronounciation Guide and have it approved by client",
				"Description_FR": "Cr√©ation d'un Guide de Prononciaition et attente d'approbation client",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "AU Post Client Review",
				"Description": "Audio script feedback implementation",
				"Description_FR": "Impl√©mentation des retours clients sur le script audio",
				"cost_category": "",
				"estimated_effort": "30"
			  },
			  {
				"Name": "AU Preflight",
				"Description": "Review instructions and translations received from eLearning team",
				"Description_FR": "V√©rification des instructions et traductions re√ßues de l'√©quipe eLearning",
				"cost_category": "",
				"estimated_effort": "10"
			  },
			  {
				"Name": "AU QC 3 Points",
				"Description": "Perfom media QC, fill QC report",
				"Description_FR": "R√©alisation d'un Qualify QC Audio avec rapport de QC",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AU QC 5 Points",
				"Description": "Perfom media QC, fill QC report",
				"Description_FR": "R√©alisation d'un Full QC Audio avec rapport de QC Full",
				"cost_category": "QM-I",
				"estimated_effort": "20"
			  },
			  {
				"Name": "AU QC Auto",
				"Description": "Automatic media QC",
				"Description_FR": "R√©alisation d'un QC Audio Automatique",
				"cost_category": "QM-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "AU QC Linear",
				"Description": "Perfom media QC, fill QC report",
				"Description_FR": "R√©alisation d'un QC Audio lin√©aire avec rapport de QC",
				"cost_category": "QM-I",
				"estimated_effort": "1.2*RT"
			  },
			  {
				"Name": "AU Record Lip-sync Dubbing",
				"Description": "Record lip-sync audio",
				"Description_FR": "Audio REC, enregistrement Audio avec synchronisation labiale",
				"cost_category": "AUDIO-I",
				"estimated_effort": "2*RT"
			  },
			  {
				"Name": "AU Record Retakes",
				"Description": "Record retakes",
				"Description_FR": "REC des reakes, enregistrement des reprises √† r√©aliser",
				"cost_category": "AUDIO-I",
				"estimated_effort": "30"
			  },
			  {
				"Name": "AU Record Timed VO",
				"Description": "Record audio",
				"Description_FR": "Enregistrement Audio",
				"cost_category": "AUDIO-I",
				"estimated_effort": "1.1*RT"
			  },
			  {
				"Name": "AU Record TTS",
				"Description": "Generate TTS audio. Includes script preparation.",
				"Description_FR": "Audio REC, enregistrement de l'audio Text To Speech (TTS), pr√©paration du script incluse",
				"cost_category": "AUDIO-I",
				"estimated_effort": "2*RT"
			  },
			  {
				"Name": "AU Record TTS PG only",
				"Description": "Generate TTS audio. Includes script preparation. Pronunciation Guide terms only.",
				"Description_FR": "Audio REC, enregistrement de l'audio Text To Speech (TTS), pr√©paration du script incluse uniquement avec les termes du guide de prononciation",
				"cost_category": "AUDIO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AU Record Untimed VO",
				"Description": "Record untimed audio",
				"Description_FR": "Audio REC, enregistrement d'Audio non synchronis√©",
				"cost_category": "AUDIO-I",
				"estimated_effort": "1.1*RT"
			  },
			  {
				"Name": "AV - Deliverable Creation ‚Äì Edit + AU",
				"Description": "Video deliverable creation with edit and audio layback",
				"Description_FR": "Cr√©ation vid√©o avec montage et int√©gration audio",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV - Deliverable Creation ‚Äì Edit + GFX",
				"Description": "Video deliverable creation with edit and graphics layback",
				"Description_FR": "Cr√©ation vid√©o avec montage et int√©gration GFX",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV - Deliverable Creation ‚Äì Edit + GFX + AU",
				"Description": "Video deliverable creation with edit, graphics and audio layback",
				"Description_FR": "Cr√©ation vid√©o avec montage, int√©gration GFX et audio",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV - Deliverable Creation ‚Äì Edit + SUB",
				"Description": "Video deliverable creation with edit and subtitle layback",
				"Description_FR": "Cr√©ation vid√©o avec montage et int√©gration de sous-titres",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV - Deliverable Creation ‚Äì Edit + SUB + GFX",
				"Description": "Video deliverable creation with edit, graphics and subtitle layback",
				"Description_FR": "Cr√©ation vid√©o avec montage, int√©gration GFX et sous-titres",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV - Deliverable Creation ‚Äì Edit + SUB +AU",
				"Description": "Video deliverable creation with edit, audio and subtitle layback",
				"Description_FR": "Cr√©ation vid√©o avec montage, int√©gration audio et sous-titres",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV - Deliverable Creation ‚Äì Edit + SUB+ GFX+ AU",
				"Description": "Video deliverable creation with edit, graphics and audio layback",
				"Description_FR": "Cr√©ation vid√©o avec montage, int√©gration GFX et audio",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV - Graphics Collect Project",
				"Description": "Graphics project collection and export",
				"Description_FR": "GFX, Rassemblement et export",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV - Graphics Creation - Dub Card",
				"Description": "Graphics dub card creation",
				"Description_FR": "GFX, Cr√©ation des dubcards",
				"cost_category": "VIDEO-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "AV - Graphics Validation",
				"Description": "Graphics project validation and graphics work estimation",
				"Description_FR": "Validation des GFX et estimation du travail GFX",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable creation",
				"Description": "Create deliverable according to specs",
				"Description_FR": "Cr√©ation vid√©o",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable Creation - AU",
				"Description": "Video deliverable creation audio layback",
				"Description_FR": "Cr√©ation vid√©o avec int√©gration audio",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable Creation - Edit",
				"Description": "Video deliverable creation with video edit",
				"Description_FR": "Cr√©ation vid√©o avec montage vid√©o",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable Creation - GFX",
				"Description": "Video deliverable creation with graphics layback",
				"Description_FR": "Cr√©ation vid√©o avec int√©gration GFX",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable Creation - GFX + AU",
				"Description": "Video deliverable creation with graphics and audio layback",
				"Description_FR": "Cr√©ation vid√©o avec int√©gration GFX et audio",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable Creation - SUB",
				"Description": "Video deliverable creation with subtitle layback",
				"Description_FR": "Cr√©ation vid√©o avec int√©gration de sous-titres",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable Creation - SUB + AU",
				"Description": "Video deliverable creation with subtitle and audio layback",
				"Description_FR": "Cr√©ation vid√©o avec int√©gration de sous-titres et audio",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable Creation - SUB + GFX",
				"Description": "Video deliverable creation with subtitle and graphics layback",
				"Description_FR": "Cr√©ation vid√©o avec int√©gration de sous-titres et GFX",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable Creation - SUB + GFX + AU",
				"Description": "Video deliverable creation with subtitle, graphics and audio layback",
				"Description_FR": "Cr√©ation vid√©o avec int√©gration de sous-titres, GFX et audio",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Deliverable QC",
				"Description": "Perform QC on Deliverable",
				"Description_FR": "R√©alisation d'un QC sur la vid√©o (master, PAD, livrables)",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Edit",
				"Description": "Edit media containing audio and video",
				"Description_FR": "Montage vid√©o et audio",
				"cost_category": "VIDEO-I",
				"estimated_effort": "30"
			  },
			  {
				"Name": "AV Graphic replacement",
				"Description": "Replacing graphic elements with localized versions",
				"Description_FR": "Remplacement des cartons GFX par les versions localis√©es",
				"cost_category": "VIDEO-I",
				"estimated_effort": "60"
			  },
			  {
				"Name": "AV Graphics Creation",
				"Description": "Create graphics",
				"Description_FR": "Cr√©ation des GFX",
				"cost_category": "VIDEO-I",
				"estimated_effort": "60"
			  },
			  {
				"Name": "AV Graphics Report Creation",
				"Description": "Create graphics report",
				"Description_FR": "Cr√©ation d'un rapport de GFX",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV ICR",
				"Description": "Video In Client Review ‚Äì Can be used for graphics or audio/subtitles with the video, depending on previous tasks and instructions",
				"Description_FR": "Review Vid√©o Client - V√©rification des audios/GFX avec une vid√©o/screener. (les t√¢ches pr√©c√©dentes peuvent d√©terminer ce que l'√©quipe cr√©e)",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "AV Layback Audio",
				"Description": "Layback the mixed audio to the video",
				"Description_FR": "Int√©gration du Mixage Audio √† la vid√©o",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Layback GFX",
				"Description": "Layback the mixed GFX to the video",
				"Description_FR": "Int√©gration des GFX √† la vid√©o",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Layback Subs",
				"Description": "Layback the mixed Subs to the video",
				"Description_FR": "Int√©gration des sous-titres √† la vid√©o",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV QC 3 Points",
				"Description": "Perfom media QC, fill QC report",
				"Description_FR": "R√©alisation d'un Qualify QC Vid√©o avec rapport de QC",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV QC 5 Points",
				"Description": "Perfom media QC, fill QC report",
				"Description_FR": "R√©alisation d'un Full QC Vid√©o avec rapport de QC",
				"cost_category": "QM-I",
				"estimated_effort": "20"
			  },
			  {
				"Name": "AV QC Auto",
				"Description": "Automatic media QC",
				"Description_FR": "R√©alisation d'un QC Vid√©o Automatique",
				"cost_category": "QM-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "AV QC Fast Forward",
				"Description": "Perfom media QC, fill QC report",
				"Description_FR": "R√©alisation d'un QC rapide  avec rapport de QC",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV QC Graphics",
				"Description": "Perform QC on graphics elements",
				"Description_FR": "R√©alisation d'un QC des GFX",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV QC Linear",
				"Description": "Perfom media QC, fill QC report",
				"Description_FR": "R√©alisation d'un QC Vid√©o lin√©aire avec rapport de QC",
				"cost_category": "QM-I",
				"estimated_effort": "1.1*RT"
			  },
			  {
				"Name": "AV Screener creation",
				"Description": "Create video screener according to specs - Audio or Subs or GFX? Or All?",
				"Description_FR": "Cr√©ation d'un screener (une vid√©o de pr√©visualisation) selon les sp√©cifications et la demande",
				"cost_category": "VIDEO-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "AV Source files check",
				"Description": "Check source files and potential project for scope and approach",
				"Description_FR": "V√©rification des √©l√©ments sources pour s'assurer de la conformit√© des √©l√©ments pour le projet",
				"cost_category": "QM-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "AV Subtitles Burn-in",
				"Description": "Subtitles burn-in",
				"Description_FR": "Incrustation de sous-titres",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Tech Check",
				"Description": "Perform technical check on media",
				"Description_FR": "V√©rification vid√©o par un op√©rateur qualifi√©",
				"cost_category": "QM-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "AV Transcode",
				"Description": "Transcode media file",
				"Description_FR": "Transcodage m√©dias",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "AV Validate textless elements",
				"Description": "Validate accuracy of textless elements",
				"Description_FR": "Validation de conformit√© des √©l√©ments Textless",
				"cost_category": "VIDEO-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "DTP Delivery",
				"Description": "Delivery of final DTPed files",
				"Description_FR": "Livraison des fichiers PAO finaux",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "DTP Edit",
				"Description": "Post-Localization DTP",
				"Description_FR": "PAO post-localisation",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "DTP Feedback implementation",
				"Description": "DTP Feedback implementation",
				"Description_FR": "Impl√©mentation des retours PAO",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "DTP PMFE",
				"Description": "Final eye review of formatting",
				"Description_FR": "R√©vision finale des √©l√©ments de PAO",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "DTP QC",
				"Description": "post-DTP QM",
				"Description_FR": "R√©alisation d'un QC post PAO",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL AV implementation",
				"Description": "Audio + Video Module Implementation",
				"Description_FR": "Impl√©mentation du module audio + vid√©o pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL Contact Sheet",
				"Description": "Text extracted from non editable images",
				"Description_FR": "Texte extrait d'images non modifiables pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL File Preparation",
				"Description": "Files preparation",
				"Description_FR": "Pr√©paration des fichiers pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL ICR",
				"Description": "Client review after build",
				"Description_FR": "Review Client apr√®s build pour le service eLearning",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL Module formatting",
				"Description": "Layout of the module",
				"Description_FR": "Mise en page du module pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL PMFE",
				"Description": "Feedback Implementation Validation",
				"Description_FR": "Validation des retours clients pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL Post client Implementation",
				"Description": "Feedback Implementation",
				"Description_FR": "Impl√©mentation des retours pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL Post client Review",
				"Description": "Feedback Review",
				"Description_FR": "R√©vision des retours pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL Preflight",
				"Description": "Planning and kick-off preparation",
				"Description_FR": "Planification et pr√©paration du lancement pour le service eLearning",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL Publish",
				"Description": "Compilation of the module",
				"Description_FR": "Compilation du module pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eL Testing",
				"Description": "Linguistic and functional testing",
				"Description_FR": "Tests linguistiques et fonctionnels pour le service eLearning",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Alpha Creation",
				"Description": "Creation of the first version of a module",
				"Description_FR": "Cr√©ation de la premi√®re version d'un module pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Alpha ID Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Alpha Testing",
				"Description": "Linguistic and functional testing",
				"Description_FR": "Tests linguistiques et fonctionnels pour le service eLearning",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Alpha UI Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "UXUI-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD AS ID Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Audio Script Creation",
				"Description": "ID preparation of the script in the media template",
				"Description_FR": "Pr√©paration ID du script dans le mod√®le m√©dia pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Beta Creation",
				"Description": "Alpha feedback implementation and audio implementation",
				"Description_FR": "Impl√©mentation des retours alpha et impl√©mentation audio pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD CM ID Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Content Map Creation",
				"Description": "The structure of the eLearning, showing what content should go in which section of the training",
				"Description_FR": "La structure du eLearning, montrant quel contenu doit aller dans quelle section de la formation pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Debrief Meeting",
				"Description": "Production team meeting once project has been done",
				"Description_FR": "R√©union de l'√©quipe de production une fois le projet termin√© pour le service eLearning",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Fixing",
				"Description": "Fixing the module/sample by developer",
				"Description_FR": "Correction du module/√©chantillon par le d√©veloppeur pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Interactive Sample Creation",
				"Description": "Interactive sample creation by dev",
				"Description_FR": "Cr√©ation d'√©chantillon interactif par le d√©veloppeur pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD IS ID Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD IS Testing",
				"Description": "Linguistic and functional testing",
				"Description_FR": "Tests linguistiques et fonctionnels pour le service eLearning",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD IS UI Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "UXUI-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Iteration Creation",
				"Description": "UI/ID working in PPT creation",
				"Description_FR": "Cr√©ation UI/ID en PPT pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Proofreading",
				"Description": "Linguistic check of SB, PT or module",
				"Description_FR": "V√©rification linguistique du SB, PT ou module pour le service eLearning",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Prototype Creation",
				"Description": "Creation of a visual representation of the content incl. the approved graphics (in the visual proposal)",
				"Description_FR": "Cr√©ation d'une repr√©sentation visuelle du contenu incluant les graphiques approuv√©s (dans la proposition visuelle) pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD PT DEV Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD PT ID Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD PT UI Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "UXUI-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD SB DEV Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD SB ID Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Storyboard Creation",
				"Description": "Content representation for the client and ID to be aligned on what content should go into the module",
				"Description_FR": "Repr√©sentation du contenu pour que le client et l'ID s'alignent sur le contenu √† int√©grer dans le module pour le service eLearning",
				"cost_category": "INSTRUCT-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Template UI Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "DEV-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD UI Template Creation",
				"Description": "Prototype template created by an UI/UX designer",
				"Description_FR": "Mod√®le de prototype cr√©√© par un concepteur UI/UX pour le service eLearning",
				"cost_category": "UXUI-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD Visual Proposal Creation",
				"Description": "Visual proposal creation by UI/UX designer to show the look and feel of the course",
				"Description_FR": "Cr√©ation de proposition visuelle par le concepteur UI/UX pour montrer l'apparence du cours pour le service eLearning",
				"cost_category": "UXUI-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "eLD VP UI Check",
				"Description": "Internal check",
				"Description_FR": "V√©rification interne pour le service eLearning",
				"cost_category": "UXUI-DESIGN",
				"estimated_effort": ""
			  },
			  {
				"Name": "GL glossary and sample creation",
				"Description": "Glossary and Translation preview creation",
				"Description_FR": "Cr√©ation de l'aper√ßu du glossaire et de la traduction pour le service eLearning",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "GL glossary and sample ICR",
				"Description": "Glossary and Translation preview ICR",
				"Description_FR": "Aper√ßu du glossaire et de la traduction avant la Review Client",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "GL glossary and sample post-client Review",
				"Description": "Glossary and Translation preview post ICR",
				"Description_FR": "Aper√ßu du glossaire et de la traduction pour la Review Client",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "GL glossary and sample translation",
				"Description": "Glossary and Translation preview translation",
				"Description_FR": "Aper√ßu du glossaire et de la traduction",
				"cost_category": "",
				"estimated_effort": ""
			  },
			  {
				"Name": "IO Asset Transfer",
				"Description": "Transfer files to External vendor",
				"Description_FR": "In Out, Transfert des fichiers au fournisseur externe",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "IO Delivery",
				"Description": "Deliver file",
				"Description_FR": "Livraison d'assets",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Delivery AU + AV",
				"Description": "Delivery of Audio and Video files",
				"Description_FR": "Livraison audio et vid√©o",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Delivery Audio",
				"Description": "Delivery file for Audio",
				"Description_FR": "Livraison audio",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Delivery Graphics",
				"Description": "Delivery file for Graphics",
				"Description_FR": "Livraison de fichiers pour les GFX",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Delivery SUB + AU",
				"Description": "Delivery of Subtitle and Audio files",
				"Description_FR": "Livraison de sous-titres et audio",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Delivery SUB + AU + GFX",
				"Description": "Delivery of Subtitle and Audio and Graphics files",
				"Description_FR": "Livraison de sous-titres, audio et GFX",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Delivery SUB + AU + GFX + AV",
				"Description": "Delivery of Subtitle, Audio, Video and Graphics files",
				"Description_FR": "Livraison de sous-titres, audio, vid√©o et GFX",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Delivery Subtitles",
				"Description": "Delivery file for subtitle",
				"Description_FR": "Livraison de sous-titres",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "3"
			  },
			  {
				"Name": "IO Delivery Transcript",
				"Description": "Delivery file for Transcript",
				"Description_FR": "Livraison de fichier pour la transcription",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "3"
			  },
			  {
				"Name": "IO Delivery Video",
				"Description": "Delivery file for Video",
				"Description_FR": "Livraison de fichier vid√©o",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Ingest Audio",
				"Description": "Ingest Audio",
				"Description_FR": "Ingest des audios",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Ingest Graphics",
				"Description": "Ingest Graphics",
				"Description_FR": "Ingest des √©lements de GFX",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "IO Ingest Subtitles",
				"Description": "Ingest Subtitles",
				"Description_FR": "Ingest des sous-titres",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "3"
			  },
			  {
				"Name": "IO Ingest Transcript",
				"Description": "Ingest Transcript",
				"Description_FR": "Ingest du script",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "3"
			  },
			  {
				"Name": "IO Ingest Video",
				"Description": "Ingest Video",
				"Description_FR": "Ingest des √©l√©ments vid√©o",
				"cost_category": "FILEMANAG-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "TT Adaptation",
				"Description": "Changing the script to adapt it to another style of text, for lip-synch",
				"Description_FR": "Modification du script pour l'adapter √† un autre style de texte, pour la synchronisation labiale",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "3*RT"
			  },
			  {
				"Name": "TT Conform",
				"Description": "Settings change to speed, offset, export to client spec",
				"Description_FR": "Modification des param√®tres du sous-titre pour la vitesse, d√©calage, export selon les sp√©cifications client",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "3*RT"
			  },
			  {
				"Name": "TT Deliverable Creation",
				"Description": "Create deliverable according to specs",
				"Description_FR": "Cr√©ation du lvrable de sous-titres selon les sp√©cifications techniques",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "1"
			  },
			  {
				"Name": "TT Export / Convert",
				"Description": "Convert one format to another one (no content or TC changes)",
				"Description_FR": "Convertion des sous-titres vers un format donn√© (pas de changement de contenu ou TC)",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "1"
			  },
			  {
				"Name": "TT Export Graphics",
				"Description": "Export of GFX package (PNG/XML or other) for Subtitle burn in",
				"Description_FR": "Export du package graphique (PNG/XML ou autre) pour l'incrustation de sous-titres",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "3"
			  },
			  {
				"Name": "TT File Rename",
				"Description": "Rename of file",
				"Description_FR": "Renommer le fichier de sous-titres, script ou transcription",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "3"
			  },
			  {
				"Name": "TT FN Template Creation",
				"Description": "Creation of EMT for FN Subtitles",
				"Description_FR": "Cr√©ation de l'EMT pour les sous-titres Forced Narrative (FN, Fona)",
				"cost_category": "TRANSCRIPT-I",
				"estimated_effort": "1.5*RT"
			  },
			  {
				"Name": "TT ICR",
				"Description": "Implementation of client review",
				"Description_FR": "Reveiw Client des sous-titres, script ou trnascription",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "TT Length check",
				"Description": "Checking the length of the script and making sure it fits in the audio",
				"Description_FR": "V√©rificarion de la longueur du script et s'assurer qu'il correspond √† l'audio",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "TT Machine Translation Post-Edit",
				"Description": "Review and correct machine translated content",
				"Description_FR": "V√©rification et correction de contenu ayant √©t√© traduit automatiquement",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "3*RT"
			  },
			  {
				"Name": "TT Micro positionning",
				"Description": "Place subtitles on screen",
				"Description_FR": "Placement les sous-titres √† l'√©cran",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "2*RT"
			  },
			  {
				"Name": "TT PMFE",
				"Description": "Linear 'Final eye' review of formatting, punctuation, double spaces, dates, client names, consistency, completeness, client instruction etc.",
				"Description_FR": "R√©vision finale lin√©aire de la mise en forme, ponctuation, doubles espaces, dates, noms de clients, coh√©rence, exhaustivit√©, instructions client, etc.",
				"cost_category": "PROJMAN-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "TT Post client Review",
				"Description": "Lingusit review & implement client changes",
				"Description_FR": "Impl√©mentation et modification du sous-titres suite aux retours clients",
				"cost_category": "PROJMAN-I",
				"estimated_effort": ""
			  },
			  {
				"Name": "TT QC linguistic 3pts",
				"Description": "Perfom 3 points linguistic QC, apply fixes, fill QC report",
				"Description_FR": "R√©alisation d'une v√©rification linguistique 3 points, appliquer les corrections, avec rapport de V√©rif.",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "TT QC linguistic 5pts",
				"Description": "Perfom 5 points linguistic QC, apply fixes, fill QC report",
				"Description_FR": "R√©alisation d'une v√©rification lingustique avanc√©e, appliquer les corrections, avec rapport de V√©rif.",
				"cost_category": "QM-I",
				"estimated_effort": "20"
			  },
			  {
				"Name": "TT QC linguistic linear",
				"Description": "Perfom linear linguistic QC; (i.e. review translated content), apply fixes, fill QC report",
				"Description_FR": "R√©alisation d'une v√©rification lingustique lin√©aire, appliquer les corrections, avec rapport de V√©rif.",
				"cost_category": "QM-I",
				"estimated_effort": "1.1*RT"
			  },
			  {
				"Name": "TT QC technical 3pts",
				"Description": "Perfom 3 points technical QC, apply fixes, fill QC report",
				"Description_FR": "R√©alisation d'un QC technique 3 points des sous-titres, appliquer les corrections, avec rapport de V√©rif.",
				"cost_category": "QM-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "TT QC Technical 3pts + DLVC",
				"Description": "Subtitle Technical QC 3pts and Deliverable Creation",
				"Description_FR": "R√©alisation d'un QC technique 3 points des sous-titres et cr√©ation du livrable",
				"cost_category": "QM-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "TT QC Technical 3pts + DLVC + GFX",
				"Description": "Subtitle Technical QC 3pts and Deliverable Creation and Graphics Export",
				"Description_FR": "R√©alisation d'un QC technique 3 points des sous-titres, cr√©ation du livrable et export graphique",
				"cost_category": "QM-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "TT QC Technical 3pts + GFX",
				"Description": "Subtitle Technical QC 3pts and Graphics Export",
				"Description_FR": "R√©alisation d'une v√©rification lingustique avanc√©e des sous-titres et export graphique",
				"cost_category": "QM-I",
				"estimated_effort": "5"
			  },
			  {
				"Name": "TT QC technical 5pts",
				"Description": "Perfom 5 points technical QC, apply fixes, fill QC report",
				"Description_FR": "R√©alisation d'un QC Technique avanc√© des sous-titres, appliquer les corrections, avec rapport de V√©rif.",
				"cost_category": "QM-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "TT QC technical linear",
				"Description": "Perfom linear technical QC, apply fixes, fill QC report",
				"Description_FR": "R√©alisation d'un QC Technique lin√©aire des sous-titres, appliquer les corrections, avec rapport de V√©rif.",
				"cost_category": "QM-I",
				"estimated_effort": "1.1*RT"
			  },
			  {
				"Name": "TT QC technical linear + DLVC",
				"Description": "Subtitle Technical QC linear and Deliverable Creation",
				"Description_FR": "R√©alisation d'un QC Technique lin√©aire des sous-titres et cr√©ation du livrable",
				"cost_category": "QM-I",
				"estimated_effort": "1.1*RT"
			  },
			  {
				"Name": "TT QC Technical linear + DLVC + GFX",
				"Description": "Subtitle Technical QC linear and Deliverable Creation and Graphics Export",
				"Description_FR": "R√©alisation d'un QC Technique lin√©aire des sous-titres, cr√©ation du livrable et export graphique",
				"cost_category": "QM-I",
				"estimated_effort": "1.1*RT"
			  },
			  {
				"Name": "TT QC Technical linear + GFX",
				"Description": "Subtitle Technical QC linear and Graphics Export",
				"Description_FR": "R√©alisation d'un QC Technique lin√©aire des sous-titres et export graphique",
				"cost_category": "QM-I",
				"estimated_effort": "1.1*RT"
			  },
			  {
				"Name": "TT Quality Management",
				"Description": "Quality check of translation, including automated checks",
				"Description_FR": "R√©alisation d'un QC de la traduction incluant les v√©rifications automatis√©es",
				"cost_category": "PROJMAN-I",
				"estimated_effort": "1.5*RT"
			  },
			  {
				"Name": "TT Re-Cut Complex",
				"Description": "Change and Check speed, offset, edit text to match media + positioning, spec changes, complex timing‚Ä¶",
				"Description_FR": "Recalage de sous-titres, modification et v√©rificaton de la vitesse, le d√©calage, √©diter le texte pour correspondre au m√©dia + positionnement, changements de sp√©cifications, timing complexe‚Ä¶",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "2*RT"
			  },
			  {
				"Name": "TT Recut Complex + DLVC",
				"Description": "Subtitle Recut Complex and Deliverable Creation",
				"Description_FR": "Recalage de sous-titres et cr√©ation du livrable",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "TT Re-Cut Simple",
				"Description": "Change and Check speed, offset, edit text to match media",
				"Description_FR": "Offset (recalage simple) de sous-titres et v√©rifier la vitesse, le d√©calage, √©diter le texte pour correspondre au m√©dia",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "TT Recut Simple + DLVC",
				"Description": "Subtitle Recut Simple and Deliverable Creation",
				"Description_FR": "Offset (recalage simple) de sous-titres et v√©rifier la vitesse, le d√©calage, √©diter le texte pour correspondre au m√©dia et cr√©ation du livrable",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "10"
			  },
			  {
				"Name": "TT Template Creation",
				"Description": "Creation of EMT for subtitles or dubbing from client video and script",
				"Description_FR": "Cr√©ation de l'EMT pour les sous-titres ou le doublage √† partir de la vid√©o et du script client",
				"cost_category": "TRANSCRIPT-I",
				"estimated_effort": "2*RT"
			  },
			  {
				"Name": "TT Template QC",
				"Description": "QC of translation template received from eLearning team",
				"Description_FR": "Contr√¥le qualit√© du template traduction re√ßu de l'√©quipe eLearning",
				"cost_category": "QM-I",
				"estimated_effort": "15"
			  },
			  {
				"Name": "TT Timecoding",
				"Description": "Timecode text present on media",
				"Description_FR": "Timecodage d'un sous-titre",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "2*RT"
			  },
			  {
				"Name": "TT Timecoding + DLVC",
				"Description": "Subtitle Timecoding and Deliverable Creation",
				"Description_FR": "Timecodage des sous-titres et cr√©ation du livrable",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "1.5*RT"
			  },
			  {
				"Name": "TT Timecoding + DLVC + GFX",
				"Description": "Subtitle Timecoding and Deliverable Creation and Graphics Export",
				"Description_FR": "Timecodage des sous-titres, cr√©ation des livrables et export graphique",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "1.5*RT"
			  },
			  {
				"Name": "TT Timecoding + GFX",
				"Description": "Subtitle Timecoding and Deliverable Creation",
				"Description_FR": "Timecodage des sous-titres et cr√©ation des livrables",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "1.5*RT"
			  },
			  {
				"Name": "TT Transcription",
				"Description": "Convert audio into text (without TC)",
				"Description_FR": "Convertion d'un audio en texte (sans TC)",
				"cost_category": "SUBTITLING-I",
				"estimated_effort": "2*RT"
			  },
			  {
				"Name": "TT Translation",
				"Description": "Translate existing content (audio or text) to another language",
				"Description_FR": "Traduction du contenu existant vers une langue tierce",
				"cost_category": "PROJMAN-I",
				"estimated_effort": "4*RT"
			  }
        ];

        // Famille 2 : T√¢ches personnalis√©es (compl√®tement √©ditables)
        let customTasksData = [];
        
        // Ordre d'affichage des familles (true = personnalis√©es en premier, false = natives en premier)
        let customTasksFirst = true;
        
        // Langue d'affichage des descriptions (true = fran√ßais, false = anglais)
        let showFrenchDescription = true;
        
        // Charger l'ordre pr√©f√©r√© depuis localStorage
        function loadFamilyOrder() {
            const saved = localStorage.getItem('familyOrder');
            if (saved !== null) {
                customTasksFirst = (saved === 'true');
            }
        }
        
        // Charger la langue pr√©f√©r√©e depuis localStorage
        function loadLanguagePreference() {
            const saved = localStorage.getItem('descriptionLanguage');
            if (saved !== null) {
                showFrenchDescription = (saved === 'french');
            }
        }
        
        // Sauvegarder l'ordre pr√©f√©r√© dans localStorage
        function saveFamilyOrder() {
            localStorage.setItem('familyOrder', customTasksFirst.toString());
        }
        
        // Sauvegarder la langue pr√©f√©r√©e dans localStorage
        function saveLanguagePreference() {
            localStorage.setItem('descriptionLanguage', showFrenchDescription ? 'french' : 'english');
        }
        
        // Inverser l'ordre des familles
        function toggleFamilyOrder() {
            customTasksFirst = !customTasksFirst;
            saveFamilyOrder();
            
            // Rafra√Æchir l'affichage
            const currentSearch = document.getElementById('searchInput').value;
            if (currentSearch) {
                searchLexique(currentSearch);
            } else {
                displayLexique();
            }
        }
        
        // Basculer entre fran√ßais et anglais
        function toggleLanguage() {
            showFrenchDescription = !showFrenchDescription;
            saveLanguagePreference();
            
            // Mettre √† jour le bouton
            const langBtn = document.getElementById('langValue');
            langBtn.textContent = showFrenchDescription ? 'üá´üá∑ FR' : 'üá¨üáß EN';
            
            // Rafra√Æchir l'affichage
            const currentSearch = document.getElementById('searchInput').value;
            if (currentSearch) {
                searchLexique(currentSearch);
            } else {
                displayLexique();
            }
        }
        
        // Charger les t√¢ches personnalis√©es depuis localStorage
        // Charger les t√¢ches personnalis√©es depuis Firestore
        async function loadCustomTasks() {
            try {
                const tasksRef = window.firestoreCollection(window.firestoreDB, 'customTasks');
                const querySnapshot = await window.firestoreGetDocs(tasksRef);
                
                customTasksData = [];
                querySnapshot.forEach((doc) => {
                    customTasksData.push(doc.data());
                });
                
                console.log('‚úÖ T√¢ches charg√©es depuis Firebase:', customTasksData.length);
                
                // √âcouter les changements en temps r√©el
                setupRealtimeSync();
                
            } catch (e) {
                console.error('‚ùå Erreur lors du chargement depuis Firebase:', e);
                customTasksData = [];
            }
        }
        
        // Synchronisation en temps r√©el
        function setupRealtimeSync() {
            const tasksRef = window.firestoreCollection(window.firestoreDB, 'customTasks');
            
            window.firestoreOnSnapshot(tasksRef, (snapshot) => {
                console.log('üîÑ Synchronisation en cours...');
                customTasksData = [];
                snapshot.forEach((doc) => {
                    customTasksData.push(doc.data());
                });
                
                // Rafra√Æchir l'affichage si on est d√©j√† connect√©
                if (accessMode !== null) {
                    const currentSearch = document.getElementById('searchInput').value;
                    if (currentSearch) {
                        searchLexique(currentSearch);
                    } else {
                        displayLexique();
                    }
                    updateStats(nativeTasksData.length + customTasksData.length, nativeTasksData.length + customTasksData.length);
                }
            });
        }
        
        // Sauvegarder les t√¢ches personnalis√©es dans Firestore
        async function saveCustomTasks() {
            try {
                // Sauvegarder chaque t√¢che avec un ID unique
                for (let i = 0; i < customTasksData.length; i++) {
                    const taskRef = window.firestoreDoc(window.firestoreDB, 'customTasks', `task_${i}`);
                    await window.firestoreSetDoc(taskRef, customTasksData[i]);
                }
                console.log('‚úÖ T√¢ches sauvegard√©es sur Firebase');
            } catch (e) {
                console.error('‚ùå Erreur lors de la sauvegarde sur Firebase:', e);
            }
        }
        
        // Obtenir toutes les cat√©gories de co√ªt uniques
        function getCostCategories() {
            const categories = new Set();
            nativeTasksData.forEach(task => {
                if (task.cost_category) {
                    categories.add(task.cost_category);
                }
            });
            return Array.from(categories).sort();
        }
        
        // Peupler le menu d√©roulant des cat√©gories
        function populateCostCategories() {
            const select = document.getElementById('taskCostCategory');
            const categories = getCostCategories();
            
            // Vider les options existantes (sauf la premi√®re)
            select.innerHTML = '<option value="">-- S√©lectionner --</option>';
            
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }
        
        // Variable pour stocker l'index de la t√¢che en cours d'√©dition
        let editingTaskIndex = null;
        
        // Ouvrir la modal d'ajout de t√¢che
        function openAddTaskModal() {
            document.getElementById('taskModalTitle').textContent = '‚ûï Ajouter une t√¢che';
            // Vider les champs manuellement
            document.getElementById('taskName').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskDescriptionFR').value = '';
            document.getElementById('taskCostCategory').value = '';
            document.getElementById('taskEstimatedEffort').value = '';
            populateCostCategories();
            editingTaskIndex = null;
            document.getElementById('taskModalOverlay').classList.remove('hidden');
            document.getElementById('taskName').focus();
        }
        
        // Ouvrir la modal d'√©dition de t√¢che
        function openEditTaskModal(index) {
            const task = customTasksData[index];
            document.getElementById('taskModalTitle').textContent = '‚úèÔ∏è Modifier la t√¢che';
            document.getElementById('taskName').value = task.Name;
            document.getElementById('taskDescription').value = task.Description;
            document.getElementById('taskDescriptionFR').value = task.Description_FR;
            populateCostCategories();
            document.getElementById('taskCostCategory').value = task.cost_category;
            document.getElementById('taskEstimatedEffort').value = task.estimated_effort;
            editingTaskIndex = index;
            document.getElementById('taskModalOverlay').classList.remove('hidden');
            document.getElementById('taskName').focus();
        }
        
        // Fermer la modal
        function closeTaskModal() {
            document.getElementById('taskModalOverlay').classList.add('hidden');
            editingTaskIndex = null;
        }
        
        // Sauvegarder la t√¢che (ajout ou modification)
        function saveTask() {
            // Validation basique
            const name = document.getElementById('taskName').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const descriptionFR = document.getElementById('taskDescriptionFR').value.trim();
            const costCategory = document.getElementById('taskCostCategory').value;
            const estimatedEffort = document.getElementById('taskEstimatedEffort').value.trim();
            
            if (!name || !description || !descriptionFR || !costCategory || !estimatedEffort) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            const task = {
                Name: name,
                Description: description,
                Description_FR: descriptionFR,
                cost_category: costCategory,
                estimated_effort: estimatedEffort
            };
            
            if (editingTaskIndex !== null) {
                // Modification
                customTasksData[editingTaskIndex] = task;
            } else {
                // Ajout
                customTasksData.push(task);
            }
            
            saveCustomTasks();
            closeTaskModal();
            
            // Rafra√Æchir l'affichage
            const currentSearch = document.getElementById('searchInput').value;
            if (currentSearch) {
                searchLexique(currentSearch);
            } else {
                displayLexique();
            }
        }
        
        // Variable pour stocker l'index de la t√¢che √† supprimer
        let deletingTaskIndex = null;
        
        // Ouvrir la modal de confirmation de suppression
        function deleteTask(index) {
            console.log('Demande de suppression de la t√¢che √† l\'index:', index);
            console.log('T√¢che:', customTasksData[index]);
            
            deletingTaskIndex = index;
            const task = customTasksData[index];
            document.getElementById('confirmMessage').textContent = 
                `√ätes-vous s√ªr de vouloir supprimer la t√¢che "${task.Name}" ?`;
            document.getElementById('confirmModalOverlay').classList.remove('hidden');
        }
        
        // Confirmer la suppression
        function confirmDelete() {
            if (deletingTaskIndex !== null) {
                const deletedTask = customTasksData[deletingTaskIndex];
                console.log('Suppression confirm√©e pour:', deletedTask);
                
                customTasksData.splice(deletingTaskIndex, 1);
                saveCustomTasks();
                console.log('T√¢che supprim√©e avec succ√®s');
                
                // Fermer la modal
                document.getElementById('confirmModalOverlay').classList.add('hidden');
                deletingTaskIndex = null;
                
                // Rafra√Æchir l'affichage
                const currentSearch = document.getElementById('searchInput').value;
                if (currentSearch) {
                    searchLexique(currentSearch);
                } else {
                    displayLexique();
                }
            }
        }
        
        // Annuler la suppression
        function cancelDelete() {
            console.log('Suppression annul√©e par l\'utilisateur');
            document.getElementById('confirmModalOverlay').classList.add('hidden');
            deletingTaskIndex = null;
        }

        // ========================================
        // CODE DU LEXIQUE - NE PAS MODIFIER
        // ========================================

        // Fonction pour afficher le lexique avec les deux familles
        function displayLexique(nativeFiltered = null, customFiltered = null) {
            const container = document.getElementById('lexiqueList');
            
            // D√©terminer les permissions selon le mode
            const canEditEstimatedEffort = (accessMode === 'partial_write' || accessMode === 'full_write');
            const canManageTasks = (accessMode === 'full_write');
            
            // Utiliser les donn√©es filtr√©es ou toutes les donn√©es
            const nativeData = nativeFiltered || nativeTasksData;
            const customData = customFiltered || customTasksData;
            
            const tooltipText = "Format : minutes (ex: 45) ou RT (ex: 2*RT)";
            
            // Cr√©er les sections HTML
            const customSection = createCustomTasksSection(customData, canEditEstimatedEffort, canManageTasks, tooltipText);
            const nativeSection = createNativeTasksSection(nativeData, canEditEstimatedEffort, tooltipText);
            
            // Afficher dans l'ordre choisi
            let html = '';
            if (customTasksFirst) {
                html = customSection + nativeSection;
            } else {
                html = nativeSection + customSection;
            }
            
            container.innerHTML = html;
        }
        
        // Fonction pour cr√©er la section des t√¢ches personnalis√©es
        function createCustomTasksSection(customData, canEditEffort, canManage, tooltipText) {
            const orderIcon = customTasksFirst ? '‚¨áÔ∏è' : '‚¨ÜÔ∏è';
            const orderTitle = customTasksFirst ? 'Descendre' : 'Monter';
            
            let html = `
                <div class="family-section">
                    <div class="family-header">
                        <div>
                            <button class="order-btn" onclick="toggleFamilyOrder()" title="${orderTitle}">${orderIcon}</button>
                            <span class="family-title">‚ú® T√¢ches personnalis√©es</span>
                            <span class="family-count">(${customData.length})</span>
                        </div>
                        ${canManage ? '<button class="add-task-btn" onclick="openAddTaskModal()">+ Ajouter</button>' : ''}
                    </div>
                    <div id="customTasksList">
            `;
            
            if (customData.length === 0) {
                html += `<div class="no-results"><p>Aucune t√¢che personnalis√©e${canManage ? ' - Cliquez sur "Ajouter" pour cr√©er' : ''}</p></div>`;
            } else {
                customData.forEach((item, index) => {
                    const actualIndex = item.originalIndex !== undefined ? item.originalIndex : index;
                    const description = showFrenchDescription ? item.Description_FR : item.Description;
                    html += `
                        <div class="lexique-item custom">
                            <div class="terme">${item.Name}</div>
                            <div class="definition">${description}</div>
                            <div class="estimated-effort">
                                <span class="estimated-effort-label" data-tooltip="${tooltipText}">Temps estim√© :</span>
                                <span class="estimated-effort-value" 
                                      contenteditable="${canEditEffort}" 
                                      data-family="custom"
                                      data-index="${actualIndex}"
                                      spellcheck="false"
                                      style="${!canEditEffort ? 'cursor: not-allowed; opacity: 0.7;' : 'cursor: text;'}"
                                      onblur="${canEditEffort ? `saveEstimatedEffort('custom', ${actualIndex}, this.textContent)` : ''}"
                                      onkeydown="${canEditEffort ? `if(event.key==='Enter'){event.preventDefault();this.blur();}` : 'event.preventDefault();'}">${item.estimated_effort || '‚Äî'}</span>
                                ${canManage ? `
                                <div class="task-actions">
                                    <button class="action-btn edit" onclick="openEditTaskModal(${actualIndex})" title="Modifier">‚úèÔ∏è</button>
                                    <button class="action-btn delete" onclick="event.stopPropagation(); deleteTask(${actualIndex});" title="Supprimer">üóëÔ∏è</button>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }
        
        // Fonction pour cr√©er la section des t√¢ches natives
        function createNativeTasksSection(nativeData, canEditEffort, tooltipText) {
            const orderIcon = customTasksFirst ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è';
            const orderTitle = customTasksFirst ? 'Monter' : 'Descendre';
            
            let html = `
                <div class="family-section">
                    <div class="family-header">
                        <div>
                            <button class="order-btn" onclick="toggleFamilyOrder()" title="${orderTitle}">${orderIcon}</button>
                            <span class="family-title">üìö T√¢ches natives GLMO</span>
                            <span class="family-count">(${nativeData.length})</span>
                        </div>
                    </div>
                    <div id="nativeTasksList">
            `;
            
            if (nativeData.length === 0) {
                html += `<div class="no-results"><p>Aucune t√¢che native trouv√©e</p></div>`;
            } else {
                nativeData.forEach((item, index) => {
                    const actualIndex = item.originalIndex !== undefined ? item.originalIndex : index;
                    const description = showFrenchDescription ? item.Description_FR : item.Description;
                    html += `
                        <div class="lexique-item">
                            <div class="terme">${item.Name}</div>
                            <div class="definition">${description}</div>
                            <div class="estimated-effort">
                                <span class="estimated-effort-label" data-tooltip="${tooltipText}">Temps estim√© :</span>
                                <span class="estimated-effort-value" 
                                      contenteditable="${canEditEffort}" 
                                      data-family="native"
                                      data-index="${actualIndex}"
                                      spellcheck="false"
                                      style="${!canEditEffort ? 'cursor: not-allowed; opacity: 0.7;' : 'cursor: text;'}"
                                      onblur="${canEditEffort ? `saveEstimatedEffort('native', ${actualIndex}, this.textContent)` : ''}"
                                      onkeydown="${canEditEffort ? `if(event.key==='Enter'){event.preventDefault();this.blur();}` : 'event.preventDefault();'}">${item.estimated_effort || '‚Äî'}</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }

        // Fonction pour sauvegarder les modifications du temps estim√©
        function saveEstimatedEffort(family, index, newValue) {
            const data = family === 'native' ? nativeTasksData : customTasksData;
            
            if (index >= 0 && index < data.length) {
                data[index].estimated_effort = newValue.trim();
                console.log(`Temps estim√© mis √† jour pour "${data[index].Name}": ${newValue}`);
                
                // Sauvegarder les t√¢ches personnalis√©es dans localStorage
                if (family === 'custom') {
                    saveCustomTasks();
                }
            }
        }

        // Fonction de recherche avec surlignage
        function searchLexique(query) {
            if (!query) {
                displayLexique();
                updateStats(nativeTasksData.length + customTasksData.length, nativeTasksData.length + customTasksData.length);
                return;
            }

            const searchTerm = query.toLowerCase();
            
            // Liste des pr√©fixes sp√©ciaux qui d√©clenchent une recherche par d√©but de ligne
            const specialPrefixes = ['io', 'tt', 'au', 'av', 'gl'];
            
            // V√©rifier si c'est un filtre sp√©cial (recherche exacte sur ces codes)
            const isSpecialFilter = specialPrefixes.includes(searchTerm);
            
            // Fonction de filtrage selon le mode
            let filterFunction;
            if (isSpecialFilter) {
                // Mode filtre sp√©cial : chercher uniquement les t√¢ches qui COMMENCENT par ce pr√©fixe
                const prefix = searchTerm.toUpperCase();
                filterFunction = (item) => item.Name.toUpperCase().startsWith(prefix);
            } else {
                // Mode recherche normale : chercher partout dans le nom
                filterFunction = (item) => item.Name.toLowerCase().includes(searchTerm);
            }
            
            // Filtrer les t√¢ches natives
            const nativeFilteredWithIndex = nativeTasksData
                .map((item, index) => ({ ...item, originalIndex: index }))
                .filter(filterFunction);

            // Filtrer les t√¢ches personnalis√©es
            const customFilteredWithIndex = customTasksData
                .map((item, index) => ({ ...item, originalIndex: index }))
                .filter(filterFunction);

            // Cr√©er une version avec surlignage uniquement sur Name
            const nativeHighlighted = nativeFilteredWithIndex.map(item => ({
                ...item,
                Name: highlightText(item.Name, isSpecialFilter ? searchTerm.toUpperCase() : searchTerm)
            }));
            
            const customHighlighted = customFilteredWithIndex.map(item => ({
                ...item,
                Name: highlightText(item.Name, isSpecialFilter ? searchTerm.toUpperCase() : searchTerm)
            }));

            displayLexique(nativeHighlighted, customHighlighted);
            
            const totalTasks = nativeTasksData.length + customTasksData.length;
            const displayedTasks = nativeHighlighted.length + customHighlighted.length;
            updateStats(totalTasks, displayedTasks);
        }

        // Fonction pour surligner le texte
        function highlightText(text, search) {
            const regex = new RegExp(`(${search})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // Fonction pour mettre √† jour les statistiques
        function updateStats(total, displayed) {
            document.getElementById('totalTerms').textContent = total;
            document.getElementById('displayedTerms').textContent = displayed;
        }
        
        // Fonction pour retourner en haut de la page
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Afficher/masquer le bouton retour en haut en fonction du scroll
        window.addEventListener('scroll', function() {
            const backToTopBtn = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        });
        
        // ========================================
        // FONCTIONS D'EXPORT
        // ========================================
        
        // Toggle menu d'export
        function toggleExportMenu() {
            const menu = document.getElementById('exportMenu');
            menu.classList.toggle('visible');
        }
        
        // Fermer le menu d'export si on clique ailleurs
        document.addEventListener('click', function(event) {
            const exportContainer = document.querySelector('.export-container');
            const exportMenu = document.getElementById('exportMenu');
            if (exportContainer && !exportContainer.contains(event.target)) {
                exportMenu.classList.remove('visible');
            }
        });
        
        // Pr√©parer les donn√©es pour l'export (toutes les t√¢ches)
        function prepareExportData() {
            const allTasks = [];
            
            // Ajouter les t√¢ches natives
            nativeTasksData.forEach(task => {
                allTasks.push({
                    'Famille': 'T√¢ches natives GLMO',
                    'Nom': task.Name,
                    'Description (EN)': task.Description,
                    'Description (FR)': task.Description_FR,
                    'Cat√©gorie de co√ªt': task.cost_category,
                    'Effort estim√©': task.estimated_effort
                });
            });
            
            // Ajouter les t√¢ches personnalis√©es
            customTasksData.forEach(task => {
                allTasks.push({
                    'Famille': 'T√¢ches personnalis√©es',
                    'Nom': task.Name,
                    'Description (EN)': task.Description,
                    'Description (FR)': task.Description_FR,
                    'Cat√©gorie de co√ªt': task.cost_category,
                    'Effort estim√©': task.estimated_effort
                });
            });
            
            return allTasks;
        }
        
        // Export en Excel
        function exportToExcel() {
            console.log('Export Excel demand√©');
            
            // Fermer le menu
            document.getElementById('exportMenu').classList.remove('visible');
            
            const data = prepareExportData();
            
            // Cr√©er une feuille de calcul
            const ws = XLSX.utils.json_to_sheet(data);
            
            // Ajuster la largeur des colonnes
            const colWidths = [
                { wch: 25 }, // Famille
                { wch: 30 }, // Nom
                { wch: 50 }, // Description EN
                { wch: 50 }, // Description FR
                { wch: 20 }, // Cat√©gorie
                { wch: 15 }  // Effort
            ];
            ws['!cols'] = colWidths;
            
            // Cr√©er un classeur
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'T√¢ches Media Orders');
            
            // G√©n√©rer le nom du fichier avec la date
            const date = new Date().toISOString().split('T')[0];
            const filename = `Lexique_Taches_Media_Orders_${date}.xlsx`;
            
            // T√©l√©charger le fichier
            XLSX.writeFile(wb, filename);
            console.log('Export Excel termin√©:', filename);
        }
        
        // Export en CSV
        function exportToCSV() {
            console.log('Export CSV demand√©');
            
            // Fermer le menu
            document.getElementById('exportMenu').classList.remove('visible');
            
            const data = prepareExportData();
            
            // Cr√©er le contenu CSV
            const headers = ['Famille', 'Nom', 'Description (EN)', 'Description (FR)', 'Cat√©gorie de co√ªt', 'Effort estim√©'];
            let csvContent = headers.join(';') + '\n';
            
            data.forEach(row => {
                const values = [
                    row['Famille'],
                    row['Nom'],
                    row['Description (EN)'],
                    row['Description (FR)'],
                    row['Cat√©gorie de co√ªt'],
                    row['Effort estim√©']
                ];
                
                // √âchapper les guillemets et entourer les valeurs de guillemets si n√©cessaire
                const escapedValues = values.map(val => {
                    if (val === null || val === undefined) return '';
                    const str = String(val);
                    if (str.includes(';') || str.includes('"') || str.includes('\n')) {
                        return '"' + str.replace(/"/g, '""') + '"';
                    }
                    return str;
                });
                
                csvContent += escapedValues.join(';') + '\n';
            });
            
            // Cr√©er un blob et t√©l√©charger
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const date = new Date().toISOString().split('T')[0];
            const filename = `Lexique_Taches_Media_Orders_${date}.csv`;
            
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('Export CSV termin√©:', filename);
        }
    </script>
</body>
</html>
